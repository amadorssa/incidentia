<h1>Edit Incident</h1>
<form id="incident-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" id="save-button">Save changes</button>
</form>

<div id="success-message" style="display: none; color: green;">
    Changes saved successfully!
</div>

<!-- Enlace para volver a la vista de detalles del incidente -->
<a href="{% url 'incidents:detail' incident.pk %}">Back to Incident Details</a>

<script>
    document.getElementById('incident-form').addEventListener('submit', function(event) {
        event.preventDefault();  // Evita el envío normal del formulario

        const formData = new FormData(this);

        fetch("{% url 'incidents:edit' incident.pk %}", {  // Asegúrate de que esta URL esté definida para la edición
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "X-Requested-With": "XMLHttpRequest",  // Añadir este header para que Django reconozca la solicitud AJAX
            },
        })
        .then(response => {
            if (response.ok) {
                return response.json();  // Obtiene la respuesta JSON en caso de éxito
            }
            throw new Error("Error en la respuesta de la solicitud.");
        })
        .then(data => {
            document.getElementById('success-message').style.display = 'block';
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred while saving the changes.");
        });
    });
</script>
